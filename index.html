<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      [data-lightning-out] {
        max-width: 68rem;
        padding-right: 15px;
        padding-left: 15px;
        margin: 0 auto !important;
      }
    </style>
  </head>
  <body>
    <script src="https://wabco--qa.sandbox.my.site.com/MyDashboard/lightning/lightning.out.js"></script>
    <div data-lightning-out="true"></div>
    <script>
      const startObserving = (domNode, classToLookFor) => {
        const observer = new MutationObserver(mutations => {
          mutations.forEach(function (mutation) {
            // console.log(Array.from(mutation.addedNodes));
      
            const elementAdded = Array.from(mutation.addedNodes).some(
              element => {
                if (element.classList) {
                  return element.classList.contains(classToLookFor);
                } else {
                  return false;
                }
              },
            );
      
            if (elementAdded) {
              // console.log('The element was added to the DOM');
              console.log(mutation.addedNodes);
              console.log(document.querySelector('.auraCss'));
            }
          });
        });
      
        observer.observe(domNode, {
          childList: true,
          attributes: true,
          characterData: true,
          subtree: true,
        });
      
        return observer;
      };
      startObserving(document.head, 'auraCss');
      
      const appName = 'c:zfPartnerLocationFinder';
      const componentName = 'c:zfPartnerLocationFinderMaster';
      const lightningEndpoint = 'https://wabco--qa.sandbox.my.site.com/MyDashboard';
      const targetElement = document.querySelector('[data-lightning-out]');
      const componentAttributes = {
        locale: 'en'
      };
    
      $Lightning.use(
        appName,
        function() {
          $Lightning.createComponent(
            componentName,
            componentAttributes,
            targetElement,
            function(cmp) {
              addAllEventListeners();	
            }
          );
        },
        lightningEndpoint
      );
      
      function addAllEventListeners() {
        const cmp = document.querySelector('c-zf-partner-location-finder-master');
        
        cmp?.addEventListener('datalayerupdate', function(event) {
    			window.dataLayer = window.dataLayer || [];
    			window.dataLayer.push(event.detail);
        });
      }
    </script>
  </body>
</html>
